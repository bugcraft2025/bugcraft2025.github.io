<!doctype html>
<meta charset="utf-8">
<title>bugcraft presence</title>
<script>
(() => {
  const ALLOWED_PARENTS = ["*"]; // replace with your site origin(s) for stricter security (e.g., "https://your-site.example")

  // Reply to explicit pings from our game page
  window.addEventListener("message", (ev) => {
    // Optional: enforce ALLOWED_PARENTS
    if (ALLOWED_PARENTS[0] !== "*" && !ALLOWED_PARENTS.includes(ev.origin)) return;

    const msg = ev.data || {};
    if (msg.type === "BUGCRAFT_PING") {
      ev.source?.postMessage({ type: "BUGCRAFT_PONG", token: msg.token }, ev.origin);
    }
  });

  // Send a small heartbeat to the parent frame every 1s
  function heartbeat() {
    try {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: "BUGCRAFT_HEARTBEAT" }, "*");
      }
    } catch {}
    setTimeout(heartbeat, 1000);
  }
  heartbeat();
})();
</script>
